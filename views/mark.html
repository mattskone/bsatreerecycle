<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mark a Pickup | BSA Tree Recycle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Styles -->
    <link rel="stylesheet" type="text/css" href="bootstrap.css">
    <link rel="stylesheet" type="text/css" href="custom.css">
    <style type="text/css">
      body {
        /*background-color: #e1ce96;*/
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .center {
        float: none;
        margin: 0 auto;
        text-align: center;
      }
      .hero-unit {
        padding: 30px;
      }
    </style>
    <link rel="stylesheet" type="text/css" href="bootstrap-responsive.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon" sizes="114x114" href="tree_114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="tree_72x72.png">
    <link rel="apple-touch-icon" sizes="57x57" href="tree_57x57.png">
    <link rel="shortcut icon" href="favicon_32x32.ico">

    <!-- Scripts -->
    <script type="text/javascript" src="jquery-1.9.0.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
          $('#output').append('{{useragent}}<br/>'); 
          $('#output').append(document.cookie);

          var name = /name=.+(?=;?)/.exec(document.cookie);
          $('#name').text(name ? unescape(name[0]).slice(5) : 'No name');
          
          $('#submit').click(function () {
            navigator.geolocation.getCurrentPosition(function(posit) {
              var d = new Date();
              var pickup = {
                'lat':posit.coords.latitude,
                'lng':posit.coords.longitude,
                'timestamp':d,
                'tag':$('#name').text()
              };
              $.post('pickups', pickup);
              $('#last_pickup').html(d.toLocaleString());
              $('#latlng').append(JSON.stringify(pickup));
              document.cookie='name=' + escape($('#name').text()) +
                ';expires=' + new Date(Date.now() + 1000*60*60*24*30);
            });
          });

          $('#change_name').click(function() {
            $('#name_input').toggle("slow").focus();
          })

          $('#name_input').keyup(function() {
            $('#name').html(
              this.value.length > 0 ? this.value : "No name"
            );
          });

          $('#name_input').blur(function() {
            $(this).toggle("slow");
          })
        });        

    </script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand">BSA Tree Recycle</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="/">Home</a></li>
              <li><a href="about">About</a></li>
              <li class="active"><a href="mark">Mark</a></li>
              <li><a href="map">Map</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="hero-unit">
        <div class="row">
          <div class="span12 center">
            <button id="submit" class="btn btn-large" type="button">Mark a Pickup</button>
            <h5>Last pickup: <em><span id="last_pickup">no pickups today</span></em></h5>
            <h5><em>'<span id="name">No name</span>'</em> will be tagged to these pickups.</h5>
            <input id="name_input" type="search" maxlength=25 placeholder="Type your name here" style="display:none"></input>
            <h6><a id="change_name" style="cursor:pointer">Change name</a> | <a href="#">What's this?</a></h6>
          </div>
          <div class="span3">
          </div>
        </div>
      </div>
    </div>

    <div id="output"></div>
    <div id="latlng"></div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="jquery-1.9.0.min.js"></script>
    <script src="bootstrap.js"></script>
  </body>
</html>